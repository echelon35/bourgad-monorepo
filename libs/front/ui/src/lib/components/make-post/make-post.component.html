<div tabindex="0" (click)="close()" (keypress)="close()" [ngClass]="{'visible': visible, 'hidden': !visible}" class="z-on-map-1 absolute top-0 left-0 w-full h-full bg-black/80">
</div>
<div class="z-on-map-1 absolute top-20 left-0 w-full">
  <div class="flex justify-center items-center mb-2">
    <img class="inline-block size-12 rounded-full mr-2" src="{{avatarUrl$ | async}}" alt="Avatar">
    <input readonly autocomplete="off" [ngClass]="{'outline-2 -outline-offset-2 outline-primary-bourgad-2': visible, 'outline-1 -outline-offset-1 outline-gray-900 hover:outline-2 hover:-outline-offset-2 hover:outline-primary-bourgad-2': !visible}" (click)="open()" type="text" name="name" id="name" class="block rounded-full bg-black hover:bg-gray-800 px-4 py-1.5 text-base text-gray-300 placeholder:text-gray-400 sm:text-sm/6 w-96 h-12 cursor-pointer pr-4 truncate"
      [placeholder]="placeholder$ | async" />
    <!-- <button [ngClass]="{'visible': visible, 'hidden': !visible}" (click)="close()" class="text-primary-bourgad-2 cursor-pointer -ml-8 hover:text-gray-600 text-2xl leading-none" type="button" aria-label="Fermer">&times;</button> -->
  </div>
  <div id="modal-post" [ngClass]="{'visible': visible, 'hidden': !visible}" class="z-modal flex items-center justify-center inset-0">

        <form [formGroup]="makePostForm" class="bg-gray-900 rounded-lg shadow-lg w-full max-w-lg p-6 relative" (ngSubmit)="makePost()">

          <div [ngClass]="{'visible': formVisible === 'form', 'hidden': formVisible !== 'form'}">
            <bgd-dropdown #category class="mb-2" [name]="'category'" [dropdownItems]="dropdownCategories" (selectedItem$)="selectCategory($event)" placeholder="Choisir une catégorie"></bgd-dropdown>
            <bgd-dropdown #subcategory class="mb-2" [name]="'subcategory'" [dropdownItems]="dropdownSubCategories" (selectedItem$)="selectSubCategory($event)" placeholder="Choisir une sous-catégorie"></bgd-dropdown>

            <div class="mb-2">
              <input placeholder="Titre" formControlName="title" type="text" required  class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm/6">
            </div>
            <!-- Textarea -->
            <div class="mb-4 relative">
              <bgd-text-editor
                formControlName="content"
                placeholder="Ajoute un commentaire...">
              </bgd-text-editor>
            </div>
            <!-- Pictures Upload -->
            <div class="mb-4 flex items-center rounded-lg border border-gray-200 relative p-3 pt-4">
              <div class="absolute -top-3 place-content-center bg-gray-900 text-gray-200 px-3 uppercase font-bold text-sm">Ajouter</div>
              <button type="button"
                      class="ml-2 w-6 h-6 cursor-pointer bg-transparent border-none p-0 flex items-center justify-center focus:outline-primary-bourgad-2"
                      (click)="openPicture()"
                      (keydown.enter)="openPicture()"
                      (keypress)="openPicture()"
                      aria-label="Ajouter une image">
                <img src="assets/add_picture.svg" alt="" class="w-6 h-6 pointer-events-none" />
              </button>
              <button type="button"
                      class="ml-3 w-6 h-6 cursor-pointer bg-transparent border-none p-0 flex items-center justify-center focus:outline-primary-bourgad-2"
                      (click)="openLocalisation()"
                      (keydown.enter)="openLocalisation()"
                      (keypress)="openLocalisation()"
                      aria-label="Ajouter une localisation">
                <img src="assets/add_location.svg" alt="" class="w-6 h-6 pointer-events-none" />
              </button>
            </div>
            @if(location){
              <div (click)="openLocalisation()" class="cursor-pointer text-gray-400 hover:text-gray-300 flex items-center mt-2 mb-2 px-2 gap-x-3">
                <img src="assets/add_location.svg" alt="" class="size-10 inline-block mr-1" />
                <p class="text-sm">Post localisé à {{location.label}}</p>
              </div>
            }
            @if(savedPreviews?.length > 0){
                <div class="mt-4 mb-6 flex flex-wrap gap-4">
                    @for(preview of savedPreviews; track preview){
                        <div class="relative size-16">
                            <img [src]="preview.url" alt="{{preview.file.name}}" class="w-full h-auto rounded-lg">
                            <p class="absolute bottom-0 left-0 right-0 text-center text-xs/5 bg-gray-900 bg-opacity-75 text-white truncate">{{preview.file.name}}</p>
                        </div>
                    }
                </div>
            }
            <!-- Submit Button -->
            <div class="mt-5 sm:mt-6">
              @if(this.isLoading){
                <button class="cursor-pointer inline-flex w-full justify-center rounded-md bg-primary-bourgad px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-primary-bourgad-2 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                  <bgd-spinner [width]="'w-auto'"></bgd-spinner>
                </button>
              }
              @else{
                <button type="submit" class="cursor-pointer inline-flex w-full justify-center rounded-md bg-primary-bourgad px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-primary-bourgad-2 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Publier</button>
              }
            </div>
            <div class="mt-3 sm:mt-4">
              <button type="button" (click)="close()" class="cursor-pointer inline-flex w-full justify-center rounded-md bg-gray-500 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-gray-400 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Annuler</button>
            </div>
          </div>

          <bgd-loadpicture [ngClass]="{'visible': formVisible === 'files', 'hidden': formVisible !== 'files'}" formControlName="pictures" [multiple]="true" [maxMo]="5" #loadPicture (closed)="savedFiles($event)"></bgd-loadpicture>
          <bgd-localize-post #localizePost (resetPlace$)="resetLocation()" (closed$)="saveLocation($event)" [ngClass]="{'visible': formVisible === 'location', 'hidden': formVisible !== 'location'}" ></bgd-localize-post>
        </form>
  </div>

</div>